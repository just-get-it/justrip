{% extends 'just_cabs_base.html' %} {% load static %} {% load crispy_forms_tags %} {% block title %}Justrip | Customer
Confirm Trip{% endblock %} {% block customcss %}
{% load mathfilters %}
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
<style>
    #map {
        /* position: absolute; */
        top: 0;
        bottom: 0;
        width: 100%;
    }

    /* #instructions {
        position: absolute;
        margin: 20px;
        width: 25%;
        top: 0;
        bottom: 20%;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.9);
        overflow-y: scroll;
        font-family: sans-serif;
        font-size: 0.8em;
        line-height: 2em;
    } */
    /* .duration {
        font-size: 2em;
    } */

    .ic-m {
        font-size: medium !important;
    }
</style>
{% load mapbox_location_field_tags %} {% location_field_includes %} {% include_jquery %} {% endblock %} {% block content %}
<div class="content">
    <div class="container-fluid">
        <div class="row p-3">
            <div class="col-md-8">
                {% if profile.is_verified %}
                <div class="alert alert-success">
                    <span> Verified Successfully</span>
                </div>
                {% else %}
                <div class="alert alert-danger">
                    <span> Verification Pending</span>
                </div>
                {% endif %} {% if messages %} {% for message in messages %} {% if message.level == DEFAULT_MESSAGE_LEVELS.INFO %}
                <div class="alert alert-info">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <i class="material-icons">close</i>
                    </button>
                    <span>{{message}}</span>
                </div>
                {% elif message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
                <div class="alert alert-success">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <i class="material-icons">close</i>
                    </button>
                    <span>
                        {{message}}</span>
                </div>
                {% elif message.level == DEFAULT_MESSAGE_LEVELS.WARNING %}
                <div class="alert alert-warning">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <i class="material-icons">close</i>
                    </button>
                    <span>
                        {{message}}</span>
                </div>
                {% elif message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
                <div class="alert alert-danger">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <i class="material-icons">close</i>
                    </button>
                    <span>
                        {{message}}</span>
                </div>
                {% endif %} {% endfor %} {% endif %}
            </div>
        </div>
        <div class="row p-3">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header card-header-primary">
                        <div class="row p-3">
                            <div class="col text-right">
                                <h3 class="card-title">Confirm {% if trip_type == 'oneway' %} One Way Trip {% else %}
                                    Round Trip {% endif %} Booking </h3>
                            </div>
                            <div class="col-md-4 text-right">
                                <h3 class="card-title">Rs.{{trip_cost.Final_Trip_Cost|floatformat:2}} </h3>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row p-3">
                            <div class="col-md-4">
                                <div class="row p-3">
                                    <div class="col-md">
                                        <h6>{{selected_vehicle.type}} - {{selected_vehicle.name}} <br> {{selected_vehicle.description}}</h6>
                                    </div>
                                </div>
                                <div class="row p-3 text-center">
                                    <img src="{{selected_vehicle.picture.url}}" height="150" width="250">
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="row p-3">
                                    <div class="col-md-4">
                                        <h6>Pickup Date:</h6>
                                        <h4><i class="material-icons ic-m">event</i>{{selected.pickup_date}}</h4>
                                    </div>
                                    <div class="col-md-4">
                                        <h6>Pickup Time:</h6>
                                        <h4><i class="material-icons ic-m">alarm_on</i>{{selected.pickup_time}}</h4>
                                    </div>
                                    <div class="col-md-4">
                                        <h6>Distance:</h6>
                                        <h4><i class="material-icons ic-m">multiple_stop</i>{{distance}} Km</h4>
                                    </div>
                                </div>
                                <div class="row p-3">
                                    <div class="col-md-12">
                                        <h5><span class="material-icons ic-m">my_location</span> {{pickup_address}}</h5>
                                    </div>
                                    <div class="col-md-12">
                                        <h5><span class="material-icons ic-m">place</span> {{drop_address}}</h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="col-md-12 p-2">
                            <hr style="border-top : 2px dotted rgb(139, 146, 169)">
                            <div class="row pl-5 pr-5 pt-2 pb-2">
                                <div class="col text-white text-center">
                                    <h4>Bill Summary:</h4>
                                </div>
                            </div>
                            <details class=" row pl-5 pr-5 pt-2 pb-2">
                                <summary class="row ">
                                    <h5 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Min
                                        Amount :</h5>
                                    <h5 class="col text-right text-white">Rs. {{trip_cost.base_cost|floatformat:2}}/-</h5>
                                </summary>
                                <div class="row">
                                    <p class="col-6 text-left">Base Cost:</p>
                                    <p class="col-3 text-right text-white">Rs. {{trip_cost.base_cost|floatformat:2}}/-</p>
                                </div>
                                <div class="row">
                                    <p class="col-6 text-left">Distance Covered in Base fare:</p>
                                    <p class="col-3 text-right text-white"> {{trip_cost.Kms_covered_in_base_fare}}Kms</p>
                                </div>
                               

                            </details>
                            <!-- # Extra Charges -->
                            <details class=" row pl-5 pr-5 pt-2 pb-2">
                                <summary class="row ">
                                    <h5 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Extra Charges :</h5>
                                    <h5 class="col text-right text-white">Rs. {{ trip_cost.applicable_distance|mul:trip_cost.rate_per_km|floatformat:2 }}/-</h5>

                                </summary>
                                
                                <div class="row ">
                                    <p class="col-6 text-left">Applicable Distance:</p>
                                    <p class="col-3 text-right text-white"> {{trip_cost.applicable_distance}} Kms</p>
                                </div>
                                <div class="row">
                                    <p class="col-6 text-left">Rate per km:</p>
                                    <p class="col-3 text-right text-white">{{trip_cost.rate_per_km}} Rs./-</p>
                                </div>
                                <div class="row ">
                                    <p class="col-6 text-left">Distance:</p>
                                    <p class="col-3 text-right text-white"> {{trip_cost.applicable_distance}} minutes</p>
                                </div>

                            </details>
                            <!-- # Surge -->
                            <details class=" row pl-5 pr-5 pt-2 pb-2">
                                <summary class="row ">
                                <h5 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Surge :</h5>
                                <h5 class="col text-right text-white">Rs. {{trip_cost.total_surge|floatformat:2}}/-</h5>

                            </summary>
                            
                                <div class="col-9">     
                            <details class=" row ">

                                <summary class="row ">
                                    <h6 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Traffic Surge:</h6>
                                    <h6 class="col text-right text-white">Rs. {{ trip_cost.applicable_distance|mul:trip_cost.traffic_surge|floatformat:2 %}/-</h6>

                                </summary>
                                
                                <div class="row ">
                                    <p class="col-6 text-left">Applicable Distance:</p>
                                    <p class="col-3 text-right text-white"> {{trip_cost.applicable_distance}} Kms</p>
                                </div>
                                <div class="row">
                                    <p class="col-6 text-left">Traffic Surge per km:</p>
                                    <p class="col-3 text-right text-white">{{trip_cost.traffic_surge|floatformat:2}} Rs./-</p>
                                </div>
   

                            </details>
                            </div>
                            <div class="col-9">
                            <details class=" row ">
                                <summary class="row ">
                                    <h6 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Fuel Surge :</h6>
                                    <h6 class="col text-right text-white">Rs. {{  trip_cost.applicable_distance|mul:trip_cost.fuel_surge_cost|floatformat:2 }}/-</h6>

                                </summary>
                                
                                <div class="row ">
                                    <p class="col-6 text-left">Applicable Distance:</p>
                                    <p class="col-3 text-right text-white"> {{trip_cost.applicable_distance}} Kms</p>
                                </div>
                                <div class="row">
                                    <p class="col-6 text-left">Fuel Surge per km:</p>
                                    <p class="col-3 text-right text-white">{{trip_cost.fuel_surge_cost|floatformat:2}} Rs./-</p>
                                </div>
   

                            </details>
                        </div>
                        <div class="col-9">
                            <details class=" row ">

                                <summary class="row ">
                                    <h6 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Route Surge :</h6>
                                    <h6 class="col text-right text-white">Rs. {{ trip_cost.applicable_distance|mul:trip_cost.route_surge_cost|floatformat:2 }}/-</h6>

                                </summary>
                                
                                <div class="row ">
                                    <p class="col-6 text-left">Applicable Distance:</p>
                                    <p class="col-3 text-right text-white"> {{trip_cost.applicable_distance}} Kms</p>
                                </div>
                                <div class="row">
                                    <p class="col-6 text-left">Route Surge per km:</p>
                                    <p class="col-3 text-right text-white">{{trip_cost.route_surge_cost|floatformat:2}} Rs./-</p>
                                </div>
   

                            </details>
                        </div>
                        </details>
                        <hr style="border-top : 2px dotted rgb(139, 146, 169)">
                        <!-- # Ride Time Charges -->
                        <details class=" row pl-5 pr-5 pt-2 pb-2">
                            <summary class="row ">
                                <h5 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Ride Time Charges /Min :</h5>
                                <h5 class="col text-right text-white">Rs. {{ trip_cost.ride_time|mul:trip_cost.ride_rate_per_min|floatformat:2 }}/-</h5>

                            </summary>
                            
                            <div class="row ">
                                <p class="col-6 text-left">Ride Time:</p>
                                <p class="col-3 text-right text-white"> {{trip_cost.ride_time|floatformat:2}} Min</p>
                            </div>
                            <div class="row">
                                <p class="col-6 text-left">Rate per min:</p>
                                <p class="col-3 text-right text-white">{{trip_cost.ride_rate_per_min}} Rs./-</p>
                            </div>
                           

                        </details>
                        <!-- # Entertainment Charges -->
                        <details class=" row pl-5 pr-5 pt-2 pb-2">
                            <summary class="row ">
                                <h5 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Entertainment Charges /Min :</h5>
                                <h5 class="col text-right text-white">Rs. {{ trip_cost.ride_time|mul:trip_cost.entertainment_rate_per_min|floatformat:2 }}/-</h5>

                            </summary>
                            
                            <div class="row ">
                                <p class="col-6 text-left">Ride Time:</p>
                                <p class="col-3 text-right text-white"> {{trip_cost.ride_time|floatformat:2}} Min</p>
                            </div>
                            <div class="row">
                                <p class="col-6 text-left">Rate per min:</p>
                                <p class="col-3 text-right text-white">{{trip_cost.entertainment_rate_per_min|floatformat:2}} Rs./-</p>
                            </div>
                           

                        </details>
                        <!-- # Waiting Charges -->
                        <details class=" row pl-5 pr-5 pt-2 pb-2">
                            <summary class="row ">
                                <h5 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Waiting Charges :</h5>
                                <h5 class="col text-right text-white">Rs. {{trip_cost.total_waiting_time|floatformat:2}}/-</h5>

                            </summary>
                            
                                <div class="col-9">     
                            <details class=" row ">

                                <summary class="row ">
                                    <h6 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Vehicle Waiting Charges /Min :</h6>
                                    <h6 class="col text-right text-white">Rs. {{trip_cost.vehicle_waiting_rate_per_minute|mul:trip_cost.waiting_time|floatformat:2 }}/-</h6>

                                </summary>
                                
                             
                                <div class="row ">
                                    <p class="col-6 text-left">Waiting Time:</p>
                                    <p class="col-3 text-right text-white"> + {{trip_cost.waiting_time|floatformat:2}} Min</p>
                                </div>
                           
                                <div class="row">
                                    <p class="col-6 text-left">Rate per min:</p>
                                    <p class="col-3 text-right text-white">{{trip_cost.vehicle_waiting_rate_per_minute|floatformat:2}} Rs./-</p>
                                </div>
   

                            </details>
                            </div>
                            <div class="col-9">
                            <details class=" row ">
                                <summary class="row ">
                                    <h6 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Driver Waiting Charges /Min :</h6>
                                    <h6 class="col text-right text-white">Rs. {{  trip_cost.driver_waiting_rate|mul:trip_cost.waiting_time|floatformat:2 }}/-</h6>

                                </summary>
                                
                               
                                <div class="row ">
                                    <p class="col-6 text-left">Waiting Time:</p>
                                    <p class="col-3 text-right text-white"> + {{trip_cost.waiting_time|floatformat:2}} Min</p>
                                </div>
                            
                              
                                <div class="row">
                                    <p class="col-6 text-left">Rate per min:</p>
                                    <p class="col-3 text-right text-white">{{trip_cost.driver_waiting_rate|floatformat:2}} Rs./-</p>
                                </div>
   

                            </details>
                        </div>
                        <div class="col-9">     
                            <details class=" row ">

                                <summary class="row ">
                                    <h6 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Driver Waiting Allowances Charges /Min :</h6>
                                    <h6 class="col text-right text-white">Rs. {{trip_cost.driver_waiting_allowance_rate|mul:trip_cost.waiting_time|floatformat:2 }}/-</h6>

                                </summary>
                                
                            
                                <div class="row ">
                                    <p class="col-6 text-left">Waiting Time:</p>
                                    <p class="col-3 text-right text-white"> + {{trip_cost.waiting_time|floatformat:2}} Min</p>
                                </div>
                        
                                <div class="row">
                                    <p class="col-6 text-left">Rate per min:</p>
                                    <p class="col-3 text-right text-white">{{trip_cost.driver_waiting_allowance_rate|floatformat:2}} Rs./-</p>
                                </div>
   

                            </details>
                            </div>
                            <div class="col-9">
                                <details class=" row ">
                                    <summary class="row ">
                                        <h6 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Driver Night Waiting Allowances Charges:</h6>
                                        <h6 class="col text-right text-white">Rs. {{  trip_cost.night_allowance_rate|mul:trip_cost.waiting_time|floatformat:2 }}/-</h6>
    
                                    </summary>
                                    
                              
                                    <div class="row ">
                                        <p class="col-6 text-left">Night Waiting Time:</p>
                                        <p class="col-3 text-right text-white"> + {{trip_cost.waiting_time|floatformat:2}} </p>
                                    </div>
                            
                                    <div class="row">
                                        <p class="col-6 text-left">Rate per min:</p>
                                        <p class="col-3 text-right text-white">{{trip_cost.night_allowance_rate|floatformat:2}} Rs./-</p>
                                    </div>
       
    
                                </details>
                            </div>
                        </details>
                        <!-- # Allowances -->
                        <details class=" row pl-5 pr-5 pt-2 pb-2">
                            <summary class="row ">
                                <h5 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Allowances:</h5>
                                <h5 class="col text-right text-white">Rs. {{trip_cost.driver_stay_allowance_per_day|mul:trip_cost.days|floatformat:2}}/-</h5>

                            </summary>
                            
                               
                            
                            <div class="col-9">
                            <details class=" row ">
                                <summary class="row ">
                                    <h6 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Driver Waiting Stay Allowances:</h6>
                                    <h6 class="col text-right text-white">Rs. {{  trip_cost.driver_stay_allowance_per_day|mul:trip_cost.days|floatformat:2 }}/-</h6>

                                </summary>
                                
                                <div class="row ">
                                    <p class="col-6 text-left">Duration:</p>
                                    <p class="col-3 text-right text-white"> {{trip_cost.days}} Days</p>
                                </div>
                                <div class="row">
                                    <p class="col-6 text-left">Rate per day:</p>
                                    <p class="col-3 text-right text-white">{{trip_cost.driver_stay_allowance_per_day|floatformat:2}} Rs./-</p>
                                </div>
   

                            </details>
                        </div>
                        
                        </details>
                        <!-- Road charges -->
                        <details class=" row pl-5 pr-5 pt-2 pb-2">
                            <summary class="row ">
                                <h5 class="col text-left"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Road Charges :</h5>
                                <h5 class="col text-right text-white">Rs. {{ trip_cost.toll|add:trip_cost.permit|add:trip_cost.parking|floatformat:2 }}/-</h5>

                            </summary>
                            
                            <div class="row ">
                                <p class="col-6 text-left">Toll:</p>
                                <p class="col-3 text-right text-white"> {{trip_cost.toll|floatformat:2}} Rs./-</p>
                            </div>
                            <div class="row">
                                <p class="col-6 text-left">Permit:</p>
                                <p class="col-3 text-right text-white">{{trip_cost.permit|floatformat:2}} Rs./-</p>
                            </div>
                            <div class="row ">
                                <p class="col-6 text-left">Parking:</p>
                                <p class="col-3 text-right text-white"> {{trip_cost.parking|floatformat:2}} Rs./-</p>
                            </div>

                        </details>
                        <!-- Convienience Charges -->
                        <div class="row pl-5 pr-5 pt-2 pb-2">
                            <div class="col text-left pl-0 pr-0">
                                <h5>Convienience Charges:</h5>
                            </div>
                            <div class="col text-right text-white pl-0 pr-0">
                                <h5>Rs.{{trip_cost.conviniance_charge|floatformat:2}}/-</h5>
                            </div>
                        </div>
                        <hr style="border-top : 2px dotted rgb(139, 146, 169)">
                            <!-- Total Charges -->
                            <div class="row pl-5 pr-5 pt-2 pb-2">
                                <div class="col text-left pl-0 pr-0">
                                    <h5>Total Charges :</h5>
                                </div>
                                <div class="col text-right text-white pl-0 pr-0">
                                    <h5 > Rs.{{trip_cost.trip_cost|floatformat:2}}/-</h5>
                                </div>
                            </div>
                            <hr style="border-top : 2px dotted rgb(139, 146, 169)">
                            {% if trip_cost.corporate %}
                            <!-- Coupon -->
                           
                            <div class="row pl-5 pr-5 pt-2 pb-2">
                                <div class="col text-left pl-0 pr-0">
                                    <h5>Corporate Coupon:</h5>
                                </div>
                                <div class="col text-right text-white pl-0 pr-0">
                                    <h5 style="color: green;">Rs.-{{trip_cost.corporate_coupon|floatformat:2}}/-</h5>
                                </div>
                            </div>
                            {% else %}
                            <details class=" col pl-5 pr-5 pt-2 pb-2">
                                <summary class="row ">
                                    <h5 class="col text-left pl-0 pr-0"><i class="fa fa-caret-down mr-2" aria-hidden="true"></i>Coupons:</h5>
                                    <h5 class="col text-right pl-0 pr-0" style="color: green;">Rs.-{{ trip_cost.coupon_value|floatformat:2 }}/-</h5>

                                </summary>
                              
                                {% for coupon in trip_cost.coupons %}
                                {% if forloop.first %}
                                <div class="col">
                                    <input required id="oneway" type="radio" name="coupon" value="{{coupon.coupon_name}}"  checked>
                                    <label   for="oneway">
                                        
                                        {{coupon.coupon_name}}    -Rs. {{coupon.coupon_value}}
                                        
                                    </label>
                                </div>
                                {% else %}
                                  <div class="col">
                                    <input required id="oneway" type="radio" name="coupon" value="{{coupon.coupon_name}}">
                                    <label for="oneway">  {{coupon.coupon_name}}    -Rs. {{coupon.coupon_value}}</label>
                                </div>
                                {% endif %}
                                {% endfor %}
                                
                              

                            </details>
                            {% endif %}
                            <!-- Wallet Amount -->
                            <div class="row pl-5 pr-5 pt-2 pb-2">
                                <div class="col text-left pl-0 pr-0">
                                    <h5> Redeem Wallet:</h5>
                                </div>
                                <div class="col text-right text-white pl-0 pr-0">
                                    <h5 style="color: green;">Rs.-{{trip_cost.redeem_wallet|floatformat:2}}/-</h5>
                                </div>
                            </div>

                            <hr style="border-top : 2px dotted rgb(139, 146, 169)">
                            <div class="row pl-5 pr-5 pt-2 pb-2 ">
                                <div class="col text-left pl-0 pr-0">
                                    <h5> Gross Total :</h5>
                                </div>
                                <div class="col text-right text-white pl-0 pr-0">
                                    <h5>Rs.{{trip_cost.Effective_Trip_Cost|floatformat:2}}/-</h5>
                                </div>
                            </div>
                            <div class="row pl-5 pr-5 pt-2 pb-2">
                                <div class="col text-left pl-0 pr-0">
                                    <h5> GST 5% :</h5>
                                </div>
                                <div class="col text-right text-white pl-0 pr-0">
                                    <h5>Rs.{{trip_cost.gst|floatformat:2}}/-</h5>
                                </div>
                            </div>
                            <hr style="border-top : 2px dotted rgb(139, 146, 169)">
                            <div class="row pl-5 pr-5 pt-2 pb-2">
                                <div class="col text-left pl-0 pr-0">
                                    <h5> Bill Amount:</h5>
                                </div>
                                <div class="col text-right text-white pl-0 pr-0">
                                    <h5>Rs.{{trip_cost.Final_Trip_Cost|floatformat:2}}/-</h5>
                                </div>
                            </div>

                            <div class="row pl-5 pr-5 pt-2 pb-2">
                                <div class="col text-left pl-0 pr-0">
                                    <h5>Justrip Money:</h5>
                                </div>
                                <div class="col text-right pl-0 pr-0">
                                    <h5 style="color: green;">Rs.-{{trip_cost.justrip_money|floatformat:2}}/-</h5>
                                </div>
                            </div>
                            <div class="row pl-5 pr-5 pt-2 pb-2">
                                <div class="col text-left pl-0 pr-0">
                                    <h5>Amount Payable:</h5>
                                </div>
                                <div class="col text-right text-white pl-0 pr-0">
                                    <h5>Rs.{{trip_cost.Final_Trip_Cost|sub:trip_cost.justrip_money|floatformat:2}}/-</h5>
                                </div>
                            </div>
                            
                            <!-- <div class="row pl-5 pr-5 pt-2 pb-2">
                                <div class="col text-left">
                                    <h5> Advanced Paid :</h5>
                                </div>
                                <div class="col text-right text-white">
                                    <h5>Rs.[[1000]]/-</h5>
                                </div>
                            </div> -->
                            <!-- <hr style="border-top : 2px dotted rgb(139, 146, 169)">
                            <div class="row pl-5 pr-5 pt-2 pb-2">
                                <div class="col text-left">
                                    <h5> Balance to be paid :</h5>
                                </div>
                                <div class="col text-right text-white">
                                    <h5>Rs.{{final_charges}}/-</h5>
                                </div>
                            </div> -->
                            <hr style="border-top : 2px dotted rgb(139, 146, 169)">
                            <!-- <div class="table-responsive">
                                <table class="table">
                                    <thead class=" text-primary">
                                        <tr>
                                            <th colspan="2 text-center">
                                                Bill Summary
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                Min Amount :
                                            </td>
                                            <td class="text-primary text-right text-white">
                                                Rs.[[]]
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                Extra [[km]] Km :
                                            </td>
                                            <td class="text-primary text-right text-white">
                                                Rs.{{fare}}
                                            </td>
                                        </tr>
                                        {% if trip_type == 'round' %}
                                        <tr>
                                            <td>
                                                Driver Allowance :
                                            </td>
                                            <td class="text-primary text-right text-white">
                                                Rs.[[driver_allowance_amount]]
                                            </td>
                                        </tr>
                                        {% endif %}
                                        <tr>
                                            <td>
                                                Redeem Wallet :
                                            </td>
                                            <td class="text-primary text-right text-white">
                                                Rs.[[redeem_wallet_amount]]
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                Gross Total :
                                            </td>
                                            <td class="text-primary text-right text-white">
                                                Rs.{{fare}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                GST 5% :
                                            </td>
                                            <td class="text-primary text-right text-white">
                                                Rs.{{tax}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                Total Balance :
                                            </td>
                                            <td class="text-primary text-right text-white">
                                                Rs.[[final_charges]]
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                Advanced Paid :
                                            </td>
                                            <td class="text-primary text-right text-white">
                                                Rs.[[advanced_amount]]
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                Payable Amount
                                            </td>
                                            <td class="text-primary text-right text-white">
                                                Rs.[[customer_balance]]
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div> -->
                        </div>
                        {% csrf_token %} {% if request.user.is_authenticated %}
                        <div class="col-md-12">
                            <div class="row p-3 text-center">
                                <div class="col text-center">
                                    <button class="btn btn-primary" onclick="hide();"
                                        id="traveller_form_collaps">Travellers
                                        information</button>
                                </div>
                            </div>
                            <div class="collapse" id="travellers_form">
                                <form method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="pickup_location" value="{{selected.pickup_location}}">
                                    <input type="hidden" name="drop_location" value="{{selected.drop_location}}">
                                    <input type="hidden" name="days" value="{{selected.days}}">
                                    <input type="hidden" name="trip_type" value="{{selected.trip_type}}">
                                    <input type="hidden" name="trip_way" value="{{selected.trip_way}}">
                                    <input type="hidden" name="trip_variant" value="{{selected.trip_variant}}">
                                    <input type="hidden" name="vehicle_group" value="{{selected.vehicle_group}}">
                                    <input type="hidden" name="vehicle_type" value="{{selected.vehicle_type}}">
                                    <input type="hidden" class="form-control" name="pickup_date" value={{selected.pickup_date}} required>
                                    <input type="hidden" class="form-control" name="pickup_time" value={{selected.pickup_time}} required>
                                    <div class="row p-3">
                                        <div class="col-md-4">
                                            <div class="form-group bmd-form-group">
                                                <label class="bmd-label-floating">Name</label>{{trform.name}}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group bmd-form-group">
                                                <label class="bmd-label-floating">Phone</label>{{trform.phone}}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group bmd-form-group">
                                                <label class="bmd-label-floating">Email</label>{{trform.email}}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row p-3">
                                        <div class="col-md-8">
                                            <div class="form-group bmd-form-group">
                                                <label class="bmd-label-floating">Traveller
                                                    Address</label>{{trform.address}}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group bmd-form-group">
                                                <label class="bmd-label-floating">No of bags:
                                                </label>{{trform.no_of_bags}}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row p-3">
                                        <div class="col-md-3">
                                            <div class="form-group bmd-form-group">
                                                <label class="bmd-label-floating">No of
                                                    Travellers</label>{{trform.no_of_travellers}}
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="bmd-label-floating">Carrier
                                                Required?</label>{{trform.carrier_required}}
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group bmd-form-group">
                                                <label class="bmd-label-floating">Special
                                                    Instructions</label>{{trform.special_instructions}}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row p-3">
                                        <div class="col">
                                            <h6 class="text-white">Payment Options:</h6>
                                        </div>
                                    </div>
                                    <div class="row p-3">
                                        <div class="col-md-4">
                                            <input required id="pay_later" type="radio" name="payment_method"
                                                value="pay_later" checked>
                                            <label for="pay_later">Pay later to driver</label><br>
                                        </div>
                                        <div class="col-md-4">
                                            <input required id="pay_now" type="radio" name="payment_method"
                                                value="full_payment">
                                            <label for="pay_now">Pay full amount now </label><br>
                                        </div>
                                        <div class="col-md-4">
                                            <input required id="pay_now" type="radio" name="payment_method"
                                                value="partial_paymnet">
                                            <label for="pay_now">Pay 30% now (Rs.{{partial_payment}})</label><br>
                                        </div>
                                    </div>
                                    <div class="row p-3 text-center">
                                        <div class="col text-center">
                                            <button type="submit" name="confirm_booking" value="True"
                                                class="btn btn-primary">Book Now</button>
                                        </div>
                                    </div>
                                </form>
                            </div>

                        </div>
                        {% else %}
                        <div class="col-md-12 text-center">
                            <p>Please login to start booking</p>
                            <a class="btn btn-primary" onclick="login_redirect()">Confirm Booking</a>
                        </div>
                        {% endif %}
                        <div class="row p-3">
                            <div class="col-md-8">
                                <div id="map" style='height: 400px;'></div>
                            </div>
                            <div class="col-md-4">
                                <div id="instructions" style='height: 400px; overflow: auto;'></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% if selected.trip_way == 'ONEWAY' %}
            <div class="col-md-4">
                <div class="card">
                    <!-- <div class="card-header card-header-primary">
                    <div class="row p-3">
                        <div class="col">
                            <h4 class='card-title'>Trip Benifits</h4>
                        </div>
                    </div>
                </div> -->
                    <div class="card-body">
                        <div class="row p-3">
                            <div class="col-md-12">
                                <div class="card-body">
                                    <h3 class='text-white'>Oneway trip benifits</h3>
                                    <hr>
                                    <div class="row p-3">
                                        <div class="col-md-2">
                                            <h1><i style="font-size:32px" class="material-icons">360</i></h1>
                                        </div>
                                        <div class="col-md">
                                            <h6 class="text-white">One Way Fares</h6>
                                            Special one-way fares to just get dropped off to your destination
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row p-3">
                                        <div class="col-md-2">
                                            <h1><i style="font-size:32px" class="material-icons">how_to_reg</i></h1>
                                        </div>
                                        <div class="col-md">
                                            <h6 class="text-white">Highly-rated drivers</h6>
                                            Experienced and polite drivers with well-serviced, comfortable cabs
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row p-3">
                                        <div class="col-md-2">
                                            <h1><i style="font-size:32px" class="material-icons">receipt_long</i></h1>
                                        </div>
                                        <div class="col-md">
                                            <h6 class="text-white">All inclusive pricing</h6>
                                            Prices inclusive of GST, state taxes and tolls on majority of the routes
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %} {% if selected.trip_way == 'ROUND' %}
            <div class="col-md-4">
                <div class="card">
                    <!-- <div class="card-header card-header-primary">
                    <div class="row p-3">
                        <div class="col">
                            <h4 class='card-title'>Trip Benifits</h4>
                        </div>
                    </div>
                </div> -->
                    <div class="card-body">
                        <div class="row p-3">
                            <div class="col-md-12">
                                <div class="card-body">
                                    <h4 class='text-white'>Round trip Benifits</h4>
                                    <hr>
                                    <div class="row p-3">
                                        <div class="col-md-2">
                                            <h1><i style="font-size:32px" class="material-icons">local_see</i></h1>
                                        </div>
                                        <div class="col-md">
                                            <h6 class="text-white">Convenient sightseeing</h6>
                                            Comfortable cabs for great vacation experiences
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row p-3">
                                        <div class="col-md-2">
                                            <h1><i style="font-size:32px" class="material-icons">local_taxi</i></h1>
                                        </div>
                                        <div class="col-md">
                                            <h6 class="text-white">Cab stays with you</h6>
                                            Take all the time you need, our driver will wait!
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row p-3">
                                        <div class="col-md-2">
                                            <h1><i style="font-size:32px" class="material-icons">multiple_stop</i></h1>
                                        </div>
                                        <div class="col-md">
                                            <h6 class="text-white">Multiple stops</h6>
                                            One ride for any number of pick-ups and drops
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endblock %} {% block customjs %}
    <script>
        function login_redirect() {
            redirect_url = encodeURIComponent(document.URL)
            login_url = "{% url 'login_page' %}";
            url = login_url + '?next=' + '"' + redirect_url + '"';
            window.location.href = url
        }

        function hide() {
            $('#travellers_form').collapse('toggle');
            $('#traveller_form_collaps').hide();
        }

        function get_cost() {
            type_id = $('#id_car_type').val();
            round_trip = $('#id_round_trip').val();
            console.log(type_id);
            if (type_id != null) {
                $.ajax({
                    type: 'POST',
                    action: 'get_cost',
                    url: '',
                    data: {
                        'type_id': type_id,
                        'distance': dist,
                        'round_trip': round_trip,
                        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                    },
                    cache: false,
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                    }

                });
            }
        }
    </script>
    <script>
        var dist = 0
        var pickup_location_string = '{{pickup_location}}';
        var drop_location_string = '{{drop_location}}';
        var temp_p = pickup_location_string.split(',');
        var temp_d = drop_location_string.split(',');
        var pickup_location = [];
        var drop_location = [];
        temp_p.forEach(cordinate => {
            console.log(cordinate);
            cordinate = parseFloat(cordinate);
            pickup_location.unshift(cordinate)
            console.log(cordinate);
        });
        temp_d.forEach(cordinate => {
            console.log(cordinate);
            cordinate = parseFloat(cordinate);
            drop_location.unshift(cordinate)
            console.log(cordinate);
        });
        console.log(pickup_location_string);
        console.log(pickup_location);
        console.log(drop_location_string);
        console.log(drop_location);




        // add the JavaScript here
        mapboxgl.accessToken = 'pk.eyJ1IjoianVzdGNhYnMiLCJhIjoiY2toc241bG1xMHVsZDJxa3ozYnF3dXRsaCJ9.T2rWGRtN1od9-w0iIRFYjg';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v10',
            center: pickup_location, // starting position
            zoom: 7
        });
        var canvas = map.getCanvasContainer();

        var start = pickup_location;

        function getRoute(end) {
            var start = pickup_location;
            var url = 'https://api.mapbox.com/directions/v5/mapbox/driving/' + start[0] + ',' + start[1] + ';' + end[0] + ',' + end[1] + '?steps=true&geometries=geojson&access_token=' + mapboxgl.accessToken;

            // make an XHR request https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest
            var req = new XMLHttpRequest();
            req.open('GET', url, true);
            req.onload = function () {
                var json = JSON.parse(req.response);
                var data = json.routes[0];
                var route = data.geometry.coordinates;
                var geojson = {
                    type: 'Feature',
                    properties: {},
                    geometry: {
                        type: 'LineString',
                        coordinates: route
                    }
                };
                // if the route already exists on the map, reset it using setData
                if (map.getSource('route')) {
                    map.getSource('route').setData(geojson);
                } else { // otherwise, make a new request
                    map.addLayer({
                        id: 'route',
                        type: 'line',
                        source: {
                            type: 'geojson',
                            data: {
                                type: 'Feature',
                                properties: {},
                                geometry: {
                                    type: 'LineString',
                                    coordinates: geojson
                                }
                            }
                        },
                        layout: {
                            'line-join': 'round',
                            'line-cap': 'round'
                        },
                        paint: {
                            'line-color': '#3887be',
                            'line-width': 5,
                            'line-opacity': 0.75
                        }
                    });
                }

                var instructions = document.getElementById('instructions');
                console.log(data);
                var steps = data.legs[0].steps;
                dist = Math.floor(data.distance / 1000);
                var tripInstructions = [];
                for (var i = 0; i < steps.length; i++) {
                    tripInstructions.push('<br><li>' + steps[i].maneuver.instruction) + '</li>';
                    instructions.innerHTML = '<br><h4 style="color: white;">Trip duration: ' + Math.floor(data.duration / 60) + ' min <span class="material-icons">alarm</span> </h4>' + '<h4 style="color: white;"> Trip Distance: ' + Math.floor(data.distance / 1000) + ' Kilometers </h4>' + tripInstructions;
                }
            };
            req.send();
        }

        map.on('load', function () {
            getRoute(start);

            map.addLayer({
                id: 'point',
                type: 'circle',
                source: {
                    type: 'geojson',
                    data: {
                        type: 'FeatureCollection',
                        features: [{
                            type: 'Feature',
                            properties: {},
                            geometry: {
                                type: 'Point',
                                coordinates: start
                            }
                        }]
                    }
                },
                paint: {
                    'circle-radius': 7,
                    'circle-color': '#3887be'
                }
            });
            var end = {
                type: 'FeatureCollection',
                features: [{
                    type: 'Feature',
                    properties: {},
                    geometry: {
                        type: 'Point',
                        coordinates: drop_location
                    }
                }]
            };
            if (map.getLayer('end')) {
                map.getSource('end').setData(end);
            } else {
                map.addLayer({
                    id: 'end',
                    type: 'circle',
                    source: {
                        type: 'geojson',
                        data: {
                            type: 'FeatureCollection',
                            features: [{
                                type: 'Feature',
                                properties: {},
                                geometry: {
                                    type: 'Point',
                                    coordinates: drop_location
                                }
                            }]
                        }
                    },
                    paint: {
                        'circle-radius': 7,
                        'circle-color': '#f30'
                    }
                });
            }
            getRoute(drop_location);
        });
    </script>

    {% endblock %} {% block sidebar %}
    <ul class="nav">


        <li class="nav-item active">
            <a class="nav-link" href="{% url 'customer_create_trip' %}">
                <i class="material-icons">alt_route</i>
                <p>Create Trip</p>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'customer_details' %}">
                <i class="material-icons">account_box</i>
                <p>My Profile</p>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'customer_active_bookings' %}">
                <i class="material-icons">navigation</i>
                <p>My Trips</p>
            </a>
        </li>
    </ul>
    {% endblock %}